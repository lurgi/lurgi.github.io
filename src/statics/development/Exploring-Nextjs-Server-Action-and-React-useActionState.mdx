# Next.js Server Actionì™€ React useActionState ì•Œì•„ë³´ê¸°

![useActionStateAndServerAction.png](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F8wujp%2FbtsLC6AxIjP%2F6w5pC7umJ9pZIQDOpffW00%2Fimg.png)

## ğŸš€Â Next.js 15vì˜ Server Action

### 1. Server Actionì´ë€?

Next.js 15ë²„ì „ì— ìƒˆë¡­ê²Œ ë„ì…ëœ Server Actionì€ ì„œë²„ì—ì„œ ì§ì ‘ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ë¡œ, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ë³µì¡í•œ ë°ì´í„° ìš”ì²­ íë¦„ì„ ë‹¨ìˆœí™”í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë²„ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•  ì‘ì—…ë“¤ì„ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ë¶„ë¦¬í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œì„ ê°„í¸í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2. Server Actionì´ í•´ê²°í•˜ëŠ” ë¬¸ì œë“¤

- **ë³µì¡í•œ ë°ì´í„° ìš”ì²­ ë¡œì§**: ê¸°ì¡´ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ fetchí•˜ê±°ë‚˜ ì„œë²„ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ API í˜¸ì¶œ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
- **í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ë¶„ë¦¬**: í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ì„œë²„ ë¡œì§ì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨ ì½”ë“œì˜ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ê°€ë…ì„±ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.
- **ì§ì ‘ì ì¸ ì„œë²„ ì‹¤í–‰**: Server Actionì„ í†µí•´ ì„œë²„ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë¡œì§ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê°„ë‹¨íˆ í˜¸ì¶œí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë²ˆê±°ë¡œìš´ REST APIë‚˜ GraphQL ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**REST API ì„¤ì •ì˜ ë²ˆê±°ë¡œì›€ ì˜ˆì‹œ**

```jsx
// api/handler.js
import db from './db';

export default async function handler(req, res) {
    if (req.method === 'POST') {
        const { userId } = req.body;
        const user = await db.users.findOne({ id: userId });
        res.status(200).json(user);
    } else {
        res.status(405).json({ error: 'Method not allowed' });
    }
}

// í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œ ì½”ë“œ
import axios from 'axios';

async function fetchUser(userId) {
    const response = await axios.post('/api/handler', { userId });
    return response.data;
}

export default function UserComponent() {
    const handleFetch = async () => {
        const user = await fetchUser('123');
        console.log(user);
    };

    return <button onClick={handleFetch}>Fetch User</button>;
}
```

**Server Action ì‚¬ìš© ì‹œ**

```jsx
"use server";

export async function fetchUser(userId) {
  const user = await db.users.findOne({ id: userId });
  return user;
}

("use client");
import { fetchUser } from "./actions/fetchUser";

export default function UserComponent() {
  const handleFetch = async () => {
    const user = await fetchUser("123");
    console.log(user);
  };

  return <button onClick={handleFetch}>Fetch User</button>;
}
```

ì´ì™€ ê°™ì´ Server Actionì„ ì‚¬ìš©í•˜ë©´ API í•¸ë“¤ëŸ¬ ì‘ì„±ê³¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œì˜ ë³„ë„ HTTP ìš”ì²­ ì½”ë“œ ì‘ì„±ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

### 3. Server Actionì˜ ì‚¬ìš©ë²•

Server Actionì€ Next.jsì˜ íŠ¹ìˆ˜í•œ íŒŒì¼ êµ¬ì¡°ì™€ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´

```jsx
// app/actions/myAction.js
"use server";

export async function myAction(data) {
  // ì„œë²„ì—ì„œ ì‹¤í–‰ë  ë¡œì§
  console.log("Received data:", data);
  return { success: true };
}
```

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì´ë¥¼ í˜¸ì¶œí•˜ë ¤ë©´

```jsx
"use client";
import { myAction } from "./actions/myAction";

export default function MyComponent() {
  const handleAction = async () => {
    const result = await myAction({ key: "value" });
    console.log(result);
  };

  return <button onClick={handleAction}>Call Action</button>;
}
```

---

## âš›ï¸ React 19vì˜ useActionState

### 1. useActionStateë€?

React 19ë²„ì „ì— ì¶”ê°€ëœ `useActionState`ëŠ” Server Actionê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ë©°, Actionì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” React í›…ì…ë‹ˆë‹¤. ì£¼ë¡œ Actionì˜ ìš”ì²­ ìƒíƒœ(pending, success, error)ë¥¼ ì¶”ì í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

### 2. useActionStateê°€ í•´ê²°í•˜ëŠ” ë¬¸ì œë“¤

- **ë¹„ë™ê¸° ìƒíƒœ ê´€ë¦¬**: ê¸°ì¡´ì—ëŠ” Action ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ useStateì™€ useEffectë¥¼ ì¡°í•©í•´ ì‘ì„±í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. `useActionState`ëŠ” ì´ë¥¼ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤.
- **ë¡œë”© ìƒíƒœ ê´€ë¦¬**: ìš”ì²­ ì¤‘ ìƒíƒœë¥¼ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆì–´ ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•©ë‹ˆë‹¤.
- **ì¤‘ë³µ ë¡œì§ ì œê±°**: ìš”ì²­ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë³„ë„ì˜ ë¡œì§ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì½”ë“œê°€ ê°„ê²°í•´ì§‘ë‹ˆë‹¤.

### 3. useActionStateì˜ ì‚¬ìš©ë²•

```jsx
import { useActionState } from 'react';
import { myAction } from './actions/myAction';

export default function MyComponent() {
    const [isPending, action] = useActionState(myAction);

    const handleClick = async () => {
        const result = await action({ key: 'value' });
        console.log(result);
    };

    return (
        <div>
            <button onClick={handleClick} disabled={isPending}>
                {isPending ? 'Loading...' 'Call Action'}
            </button>
        </div>
    );
}
```

---

## ğŸ› ï¸ Server Actionê³¼ useActionState ì‚¬ìš©ì˜ ì˜ˆì‹œ

ìì„¸í•œ ì½”ë“œë¥¼ í™•ì¸í•˜ì‹œê³  ì‹¶ìœ¼ì‹œë©´ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”!

[action-state-prac](https://github.com/lurgi/action-state-prac)

### 1. Server Action í•¨ìˆ˜ ë§Œë“¤ê¸°

```tsx
"use server";

// ...
export async function login(
  currentState: LoginReturn,
  formData: FormData
): Promise<LoginReturn> {
  const email = formData.get("email") as string;
  const password = formData.get("password") as string;

  if (email !== "lurgi@gmail.com" || password !== "qwer1234") {
    return {
      email,
      password,
      message: "fail",
      isError: true,
    };
  }

  return {
    email,
    password,
    message: "success",
    isError: false,
  };
}
```

### 2. useActionStateë¡œ ë¶ˆëŸ¬ì˜¤ê¸°

```tsx
"use client";

import { useActionState, useEffect, useState } from "react";
import { login } from "./action/login";

export default function Home() {
  const [state, formAction, isPending] = useActionState(login, {
    email: "",
    password: "",
    message: undefined,
    isError: false,
  });

  const { email, password, message, isError } = state;

  return (
    <div className="grid place-items-center h-screen">
      <form className="w-96" action={formAction}>
        <label className="form-control w-full">
          <div className="label">
            <span className="label-text">Email</span>
          </div>
          <input
            name="email"
            type="email"
            placeholder="Email"
            className="input input-bordered w-full"
            defaultValue={email}
          />
        </label>
        <label className="form-control w-full">
          <div className="label">
            <span className="label-text">Password</span>
          </div>
          <input
            name="password"
            type="password"
            placeholder="Password"
            className="input input-bordered w-full"
            defaultValue={password}
          />
        </label>
        <div className="label">
          <button className="btn btn-primary w-full" disabled={isPending}>
            Login
          </button>
        </div>
      </form>
    </div>
  );
}
```

### 3. ë¡œë”© ìƒíƒœ(isPending) ì»¨íŠ¸ë¡¤

`isPending`ì„ í™œìš©í•´ ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œí•˜ê³ , ì‚¬ìš©ìê°€ ìš”ì²­ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë„ë¡ ì•ˆë‚´í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë” ë‚˜ì€ UXë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì•„ë˜ëŠ” `isPending`ì„ ì´ìš©í•˜ì—¬ `Toast` ë©”ì„¸ì§€ë¥¼ ì»¨íŠ¸ë¡¤ í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

```tsx
export default function Home() {
  const [state, formAction, isPending] = useActionState(login, {
    email: "",
    password: "",
    message: undefined,
    isError: false,
  });

  const [hasToast, setHasToast] = useState(false);
  const { email, password, message, isError } = state;

  useEffect(() => {
    let timer: NodeJS.Timeout | undefined;

    if (isPending) {
      setHasToast(true);
    }
    if (!isPending) {
      timer = setTimeout(() => setHasToast(false), 3000);
    }

    return () => {
      if (timer) clearTimeout(timer);
    };
  }, [isPending, setHasToast]);

  return (
	  {/*...*/}
	  <div className="toast toast-bottom toast-center">
        {hasToast &&
          message &&
          (isError ? (
            <div role="alert" className="alert alert-error">
              <span>Error! {message}</span>
            </div>
          ) : (
            <div role="alert" className="alert alert-success">
              <span>{message}</span>
            </div>
          ))}
      </div>
	)
}
```

---

## ğŸ“Â ë³€í™”í•˜ëŠ” ë°ì´í„° fetchingê³¼ mutate ìƒíƒœê³„

Next.jsì˜ Server Actionê³¼ Reactì˜ `useActionState`ëŠ” í´ë¼ì´ì–¸íŠ¸-ì„œë²„ í†µì‹ ì—ì„œ ë°œìƒí•˜ëŠ” ë³µì¡ì„±ì„ í¬ê²Œ ì¤„ì—¬ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ ë‘ ê¸°ëŠ¥ì€ ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¡œì§ê³¼ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ê²°í•©í•˜ì—¬ ë°ì´í„° ìš”ì²­ê³¼ ìƒíƒœ ê´€ë¦¬ë¥¼ í›¨ì”¬ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

### ê¸°ì¡´ì˜ mutate ë°©ì‹ê³¼ì˜ ë¹„êµ

React ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ë³€í˜•(mutate)í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ë°©ì‹ì€ Tanstack Queryì˜ `useMutate` í›…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. ì´ ë°©ì‹ì€ ê°•ë ¥í•œ ìºì‹±ê³¼ ë°ì´í„° ë™ê¸°í™” ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, ëŒ€ê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¡œ ìë¦¬ ì¡ì•˜ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ `useActionState`ê°€ ë“±ì¥í•˜ë©´ì„œ mutate ìƒíƒœ ê´€ë¦¬ëŠ” ì´ì „ë³´ë‹¤ í›¨ì”¬ ê°„ì†Œí™”ë˜ì—ˆìŠµë‹ˆë‹¤. `useActionState`ëŠ” ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” Server Actionê³¼ ì§ì ‘ í†µí•©ë˜ì–´, ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë¡œì§ê³¼ ìƒíƒœ ê´€ë¦¬ ë¡œì§ì„ í•œ ê³³ì— ê²°í•©í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë³„ë„ì˜ ìºì‹±ì´ë‚˜ ë¡œì§ ë¶„ë¦¬ê°€ í•„ìš” ì—†ìœ¼ë©°, ì§ê´€ì ì¸ ì‚¬ìš© ë°©ì‹ ë•ë¶„ì— ì½”ë“œ ì‘ì„±ì´ ê°„ê²°í•´ì¡ŒìŠµë‹ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ, Next.jsì™€ Reactê°€ ì œê³µí•˜ëŠ” ìµœì‹  ë„êµ¬ë“¤ì€ ë°ì´í„° ìš”ì²­ê³¼ ìƒíƒœ ê´€ë¦¬ì˜ ë°©ì‹ì— í° ë³€í™”ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ Tanstack Queryì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë” íŠ¹í™”ëœ ì˜ì—­ì—ì„œ í™œìš©ë  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ë©°, Reactì˜ ìƒíƒœê³„ëŠ” ì ì  ë” ê°„ë‹¨í•˜ê³  íš¨ìœ¨ì ì¸ ë°©í–¥ìœ¼ë¡œ ë°œì „í•  ê²ƒì…ë‹ˆë‹¤.

ì¶”í›„ì— `useLoaderState`ì™€ ê°™ì€ fetchingì„ ë‹´ë‹¹í•˜ëŠ” APIê°€ ì œê³µëœë‹¤ë©´, Tanstack Queryì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ ì–´ë–¤ ì—­í• ë¡œ í™œìš©ë ê¹Œìš”?
